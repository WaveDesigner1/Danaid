<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danaid Chat</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <h1>üîê Danaid Chat</h1>
                <span class="user-info">Zalogowany jako: <strong>{{ current_user.username }}</strong></span>
            </div>
            <div class="header-right">
                <button id="friend-requests-btn" class="btn btn-secondary">
                    Zaproszenia <span id="friend-request-count" class="notification-badge" style="display: none;">0</span>
                </button>
                <button id="add-friend-btn" class="btn btn-primary">Dodaj znajomego</button>
                <a href="/logout" class="btn btn-danger">Wyloguj</a>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>Znajomi</h3>
                    <ul id="friend-list" class="friend-list">
                        <!-- Friends will be loaded here -->
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <h3>Aktywne rozmowy</h3>
                    <div id="sessions-list" class="sessions-list">
                        <!-- Sessions will be loaded here -->
                    </div>
                </div>
            </aside>

            <!-- Chat Area -->
            <main class="chat-area">
                <!-- ‚úÖ ZAKTUALIZOWANY CHAT HEADER Z PRZYCISKAMI -->
                <div class="chat-header">
                    <div id="chat-header" class="chat-info">
                        <div class="welcome-message">Wybierz znajomego, aby rozpoczƒÖƒá rozmowƒô</div>
                    </div>
                    
                    <!-- ‚úÖ CHAT ACTIONS - PRZYCISKI WYCZY≈öƒÜ/USU≈É -->
                    <div class="chat-actions" style="display: none;">
                        <button id="clear-conversation-btn" class="btn btn-warning btn-sm" title="Wyczy≈õƒá wiadomo≈õci (Ctrl+Delete)">
                            üßπ Wyczy≈õƒá
                        </button>
                        <button id="delete-conversation-btn" class="btn btn-danger btn-sm" title="Usu≈Ñ rozmowƒô (Ctrl+Shift+Delete)">
                            üóëÔ∏è Usu≈Ñ
                        </button>
                    </div>
                </div>

                <!-- Messages Container -->
                <div id="messages" class="messages-container">
                    <div class="welcome-message">Wybierz znajomego, aby rozpoczƒÖƒá rozmowƒô</div>
                </div>

                <!-- Typing Indicator -->
                <div id="typing-indicator" class="typing-indicator" style="display: none;">
                    <span>Kto≈õ pisze...</span>
                </div>

                <!-- Message Input -->
                <div class="message-input-container">
                    <input type="text" id="message-input" class="message-input" 
                           placeholder="Napisz wiadomo≈õƒá..." disabled>
                    <button id="send-button" class="send-button" disabled>
                        <span>üì§</span>
                    </button>
                </div>
            </main>
        </div>

        <!-- Connection Status -->
        <div id="connection-status" class="connection-status">
            <span class="status-indicator"></span>
            <span class="status-text">≈ÅƒÖczenie...</span>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Add Friend Modal -->
    <div id="add-friend-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Dodaj znajomego</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <label for="friend-username-input">Nazwa u≈ºytkownika:</label>
                <input type="text" id="friend-username-input" class="input-field" placeholder="Wpisz nazwƒô u≈ºytkownika">
                <button id="send-friend-request-btn" class="btn btn-primary">Wy≈õlij zaproszenie</button>
            </div>
        </div>
    </div>

    <!-- Friend Requests Modal -->
    <div id="friend-requests-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Zaproszenia do znajomych</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="friend-requests-list">
                    ≈Åadowanie...
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notifications" class="notifications-container"></div>

    <!-- Load Scripts -->
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    
    <!-- ‚úÖ INITIALIZE FRIEND REQUESTS BUTTON -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const friendRequestsBtn = document.getElementById('friend-requests-btn');
            if (friendRequestsBtn) {
                friendRequestsBtn.addEventListener('click', () => {
                    if (window.chatManager) {
                        window.chatManager._showFriendRequestsModal();
                    }
                });
            }
        });
    </script>
</body>
</html>
